#!/bin/bash

if [ -e "./bin/setenv.sh" ]; then
  echo "Setting up environment with /bin/setenv.sh"
  chmod +x bin/setenv.sh
  . ./bin/setenv.sh
fi

echo "Running hippo:latest"
docker run \
  -p 5901:5900 -p 5000:5000 -p 9001:9001 \
  -v "$(pwd):/opt/hippo" \
  -e "HIPPO_ENVIRONMENT=$HIPPO_ENVIRONMENT" \
  -e "HIPPO_MANDRILL_KEY=$HIPPO_MANDRILL_KEY" \
  -e "HIPPO_GRAYLOG_FACILITY=$HIPPO_GRAYLOG_FACILITY" \
  -e "HIPPO_GRAYLOG_LEVEL=$HIPPO_GRAYLOG_LEVEL" \
  -e "HIPPO_S3_BUCKET=$HIPPO_S3_BUCKET" \
  -e "HIPPO_RHINO_HOST=$HIPPO_RHINO_HOST" \
  -e "HIPPO_PORT=$HIPPO_PORT" \
  -e "GITHUB_REPO=$GITHUB_REPO" \
  -e "GITHUB_TOKEN=$GITHUB_TOKEN" \
  -e "GITHUB_DIRECTORY=$GITHUB_DIRECTORY" \
  -e "GITHUB_BRANCH=$GITHUB_BRANCH" \
  -e "ALLOW_BASE_CAPTURE=$ALLOW_BASE_CAPTURE" \
  -e "HIPPO_AEM_USERNAME=$HIPPO_AEM_USERNAME" \
  -e "HIPPO_AEM_PASSWORD=$HIPPO_AEM_PASSWORD" \
  -e "PFIZER_USERNAME=$PFIZER_USERNAME" \
  -e "PFIZER_PASSWORD=$PFIZER_PASSWORD" \
  -e "PFIZER_AUTH_URL=$PFIZER_AUTH_URL" \
  -e "AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID" \
  -e "AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY" \
  -e "SAUCE_LABS_USERNAME=$SAUCE_LABS_USERNAME" \
  -e "SAUCE_LABS_ACCESS_KEY=$SAUCE_LABS_ACCESS_KEY" \
  "$@" \
  hippo